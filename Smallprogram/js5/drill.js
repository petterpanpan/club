"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(a,o){try{var i=t[a](o),c=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)});e(c)}("next")})}}!function(e){var t,r,n,a,o,i=new Map,c=new Map,s=new Map,u=new Map,f={},p={loadNum:3,time:1e3,backups:new Set},d={processors:i,loaders:c,bag:s,paths:u,dirpaths:f,errInfo:p,baseUrl:"",tempM:{}},l=function(){return Math.random().toString(32).substr(2)},v=Object.prototype.toString,h=function(e){return(t=e,v.call(t).toLowerCase().replace(/(\[object )|(])/g,"")).search("function")>-1;var t},m=(t=!1,r=[],function(e){t||(t=!0,setTimeout(function(){for(var e=0;e<r.length;e++)r[e]();r=[],t=!1},0)),r.push(e)}),g=function(e){var t=e.match(/(.+\/).+/);return t&&t[1]},k=g(document.location.href);c.set("css",function(e){var t=document.createElement("link");t.rel="stylesheet",t.href=e.link,t.onload=function(){e.stat=3},t.onerror=function(){e.stat=2},document.head.appendChild(t)}),c.set("json",(n=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,e.prev=1,e.next=4,fetch(t.link);case 4:r=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),t.stat=2,e.abrupt("return");case 11:return e.next=13,r.json();case 13:r=e.sent,t.getPack=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r);case 1:case"end":return e.stop()}},e,void 0)})),t.stat=3;case 16:case"end":return e.stop()}},e,void 0,[[1,7]])})),function(e){return n.apply(this,arguments)})),c.set("wasm",(a=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,e.prev=1,e.next=4,fetch(t.link);case 4:r=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),t.stat=2,e.abrupt("return");case 11:return e.next=13,r.arrayBuffer();case 13:return r=e.sent,e.next=16,WebAssembly.compile(r);case 16:n=e.sent,a=new WebAssembly.Instance(n),t.getPack=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.exports);case 1:case"end":return e.stop()}},e,void 0)})),t.stat=3;case 20:case"end":return e.stop()}},e,void 0,[[1,7]])})),function(e){return a.apply(this,arguments)})),i.set("file",function(e){e.stat=3}),i.set("define",(o=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=d.tempM.d,a={exports:n={}},h(r)&&(o=t.path,i=t.dir,r=r(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return y(x(t,i))},n,a,{FILE:o,DIR:i})),!(r instanceof Promise)){e.next=7;break}return e.next=6,r;case 6:r=e.sent;case 7:!r&&(c=a.exports,0 in Object.keys(c))&&(r=a.exports),t.getPack=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r);case 1:case"end":return e.stop()}},e,void 0)})),t.stat=3;case 10:case"end":return e.stop()}var c},e,void 0)})),function(e){return o.apply(this,arguments)})),i.set("task",function(e){var t=d.tempM.d;if(!h(t))throw"task must be a function";var r,n=e.path,a=e.dir;e.getPack=(r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return y(x(t,a))},r.data,{FILE:n,DIR:a});case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}},e,void 0)})),function(e){return r.apply(this,arguments)}),e.stat=3}),i.set("init",function(e){var t=d.tempM.d;if(!h(t))throw"init must be a function";var r,n=e.path,a=e.dir,o=0,i=void 0;e.getPack=(r=_asyncToGenerator(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=2;break}return e.abrupt("return",i);case 2:return e.next=4,t(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return y(x(t,a))},r.data,{FILE:n,DIR:a});case 4:return i=e.sent,o=1,e.abrupt("return",i);case 7:case"end":return e.stop()}},e,void 0)})),function(e){return r.apply(this,arguments)}),e.stat=3}),c.set("js",function(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=e.link,t.addEventListener("load",function(){var t=d.tempM,r=t.type,n=t.moduleId;n&&(s.get(n)||s.set(n,e));var a=i.get(r||"file");if(!a)throw"no such this processor => "+r;a(e),d.tempM={}}),t.addEventListener("error",function(){e.stat=2}),document.head.appendChild(t)});var b=function(e){var t=s.get(e.path);if(!t){var r,n=1;_defineProperty(r={get stat(){return n},set stat(e){var t=n;n=e,this.changes.forEach(function(e){return e({change:"stat",oldStat:t,stat:n})})},dir:e.dir,path:e.path,link:e.link},"dir",e.dir),_defineProperty(r,"changes",new Set),_defineProperty(r,"fileType",e.fileType),_defineProperty(r,"getPack",function(e){var t=this;return _asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,t)}))()}),t=r,s.set(e.path,t);var a=c.get(e.fileType);if(!a)throw"no such this loader => "+t.fileType;a(t)}return new Promise(function(r,n){switch(t.stat){case 2:case 1:var a=void 0;t.changes.add(a=function(o){switch(o.stat){case 3:t.getPack(e).then(r),t.changes.delete(a),t=null;break;case 2:if((void 0!=t.loadCount?t.loadCount:t.loadCount=0)<p.loadNum){t.loadCount++;var i=c.get(t.fileType);setTimeout(function(){return i(t)},p.time)}else{var s=p.backups;if(s.size){var u=void 0!=t.backupId?t.backupId:t.backupId=-1;if(u<s.size){var f=Array.from(s),d=f[u]||t.dir,l=f[u=++t.backupId];t.loadCount=1,t.link=t.link.replace(new RegExp("^"+d),l);var v=c.get(t.fileType);return void setTimeout(function(){return v(t)},p.time)}}t.stat=4}break;case 4:n("source error")}});break;case 3:m(function(){t.getPack(e).then(r)});break;case 4:n("source error")}})},y=function(e){var t=void 0,r=new Promise(function(r,n){var a,o=[],i=e.length,c=i,s=[];e.forEach((a=_asyncToGenerator(regeneratorRuntime.mark(function e(a,u){var f,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return f="succeed",e.next=3,b(a).catch(function(e){f="error",Object.assign(a,{type:"error",descript:e}),s.push(a)});case 3:p=e.sent,o[u]=p,t&&t({id:u,sum:c,ready:c-i+1,stat:f}),--i||(s.length?n(s):r(1==c?p:o),o=null);case 8:case"end":return e.stop()}},e,void 0)})),function(e,t){return a.apply(this,arguments)}))});return r.post=function(t){return e.forEach(function(e){return e.data=t}),this},r.pend=function(e){return t=e,this},r},w=function(e){var t=e.str;if(s.has(t)){var r=s.get(t);return Object.assign(e,{path:r.path,link:r.link,dir:r.dir}),e}var n=t.split(/\s/).filter(function(e){return e&&e}),a=n.slice(1),o=n[0],i=o.match(/(.+)\?(\S+)$/)||"";i&&(o=i[1],i=i[2]);var c=R.cacheInfo,p=c.k,l=c.v;p&&l&&(i&&(i+="&"),i+=p+"="+l);var v=u.get(o);if(v)o=v;else for(var h in f){var m=f[h];if(m.reg.test(o)){o=o.replace(m.reg,m.value);break}}var b=function(e){var t=void 0,r=e.split("/").pop().match(/(.+)\.(.+)/);return r&&(t=r[2]),t}(o)||"js";o=o.replace(new RegExp("\\."+b+"$"),"");var y,w=void 0;if(w=a.indexOf("-r")>-1||/^.+:\/\//.test(o)?o:/^\./.test(o)?e.relative?e.relative+o:o.replace(/^\.\//,""):d.baseUrl+o,a.includes("-pack")){var x=w.match(/(.+)\/(.+)/);2 in x&&(o=w=x[1]+"/"+x[2]+"/"+x[2])}/^.+:\/\//.test(w)||(w=k+w),w=w.replace(/\/\.\//,"/"),/\.\.\//.test(w)&&(y=[],w.split(/\//g).forEach(function(e){".."==e&&y.length&&".."!=y.slice(-1)[0]?y.pop():y.push(e)}),w=y.join("/"));var I=g(w+="."+b),T=i?w+"?"+i:w;return Object.assign(e,{link:T,search:i,ori:o,fileType:b,path:w,dir:I,param:a}),e},x=function(e,t){var r=l();return e.map(function(e,n){return w({loadId:l(),id:n,str:e,groupId:r,relative:t})})},R={load:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return y(x(t))},remove:function(e){var t=w({str:e}).path;if(s.has(t))return s.delete(t),!0;console.warn("pack %c"+e,"color:red","does not exist")},has:function(e){var t=w({str:e}).path,r=s.get(t);return r&&r.stat},config:function(e){e.baseUrl&&(d.baseUrl=e.baseUrl);var t=e.paths;t&&Object.keys(t).forEach(function(e){/\/$/.test(e)?f[e]={reg:new RegExp("^"+e),value:t[e]}:u.set(e,t[e])}),d.baseUrl&&e.backups&&e.backups.forEach(function(e){p.backups.add(e)})},define:function(e,t){d.tempM={type:"define",d:e,moduleId:t}},task:function(e,t){d.tempM={type:"task",d:e,moduleId:t}},init:function(e,t){d.tempM={type:"init",d:e,moduleId:t}},ext:function(e,t){if(h(e))e(d);else{var r=void 0,n=function(){for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];return t(n,r,d)};switch(e){case"fixUrlObj":r=w,w=n;break;case"load":r=y,y=n;break;case"agent":r=b,b=n}}},cacheInfo:{k:"d_ver",v:""},debug:{bag:s}};e.load||(e.load=R.load),e.define||(e.define=R.define),e.task||(e.task=R.task),e.init||(e.init=R.init);var I=document.currentScript;if(!I&&(I=document.querySelector(["drill-cache"])),I){var T=I.getAttribute("drill-cache");T&&(R.cacheInfo.v=T)}var P=e.drill;Object.defineProperty(e,"drill",{get:function(){return R},set:function(e){h(e)?e(R):console.error("drill type error =>",e)}}),P&&P(R)}(window);